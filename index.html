<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Chat Client</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
      }
      #chat-container {
        max-width: 800px;
        margin: 50px auto;
        padding: 1%;
        background: #ffffff;
        border: 1px solid green;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        overflow: hidden;
      }
      #chat-header {
        background-color: #4caf50;
        color: white;
        padding: 10px;
        text-align: center;
        font-size: 25px;
      }
      #messages {
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        border-bottom: 1px solid #ddd;
      }
      .message {
        margin-bottom: 10px;
      }
      .message.you {
        color: green;
      }
      .message.opponent {
        color: orange;
      }
      .message.system {
        color: #555;
        font-style: italic;
      }
      #input-container {
        display: flex;
        padding: 10px;
      }
      #message-input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      #send-button {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        margin-left: 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      #send-button:disabled {
        background-color: #aaa;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div id="chat-container">
      <div id="chat-header">WebSocket Chat</div>
      <div id="messages"></div>
      <div id="input-container">
        <textarea
          id="message-input"
          placeholder="Type your message..."
        ></textarea>
        <button id="send-button" disabled>Send</button>
      </div>
      
    </div>
    <script src="script.js"></script>
  </body>
</html> -->

<!-- MULTI CLIENT ON SAME PAGE -->
<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Chat</title>
    <style>
      .message {
        padding: 5px;
        margin: 5px 0;
      }
      .system {
        background-color: #f0f0f0;
      }
      .you {
        background-color: #cce5ff;
      }
      .opponent {
        background-color: #d4edda;
      }
    </style>
  </head>
  <body>
    <div id="messages" style="height: 300px; overflow-y: scroll"></div>
    <input type="text" id="message-input" placeholder="Type a message..." />
    <button id="send-button" disabled>Send</button>

    <script>
      // WebSocket server URL
      const serverAddress = "wss://messenger-vywa.onrender.com";

      // Select elements
      const messagesDiv = document.getElementById("messages");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");

      // Create WebSocket connection
      const client = new WebSocket(serverAddress);

      // Explicitly set binary type
      client.binaryType = "blob";

      client.onopen = () => {
        addMessage("System: Connected to the server.", "system");
        sendButton.disabled = false;
      };

      client.onmessage = (event) => {
        if (event.data instanceof Blob) {
          const reader = new FileReader();
          reader.onload = () => {
            handleIncomingMessage(reader.result);
          };
          reader.readAsText(event.data);
        } else {
          handleIncomingMessage(event.data);
        }
      };

      client.onclose = () => {
        addMessage("System: Disconnected from the server.", "system");
        sendButton.disabled = true;
      };

      client.onerror = (error) => {
        addMessage(`System: WebSocket error: ${error.message}`, "system");
      };

      // Handle send button click
      sendButton.addEventListener("click", () => {
        const message = messageInput.value.trim();
        if (message) {
          client.send(message);
          addMessage(`You: ${message}`, "you");
          messageInput.value = "";
        }
      });

      // Handle pressing Enter to send a message
      messageInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          sendButton.click();
        }
      });

      // Function to handle incoming messages

      function handleIncomingMessage(data) {
        try {
          const message = JSON.parse(data); // Parse the JSON message
          if (message.type === "system") {
            addMessage(`System: ${message.content}`, "system");
          } else if (message.type === "user") {
            addMessage(`${message.sender}: ${message.content}`, "opponent");
          }
        } catch (error) {
          console.error("Error parsing incoming message:", error);
          addMessage(`Opponent: ${data}`, "opponent");
        }
      }

      // Function to add a message to the chat
      function addMessage(content, type) {
        const messageElement = document.createElement("div");
        messageElement.classList.add("message", type);
        messageElement.textContent = content;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to the latest message
      }
    </script>
  </body>
</html> -->



<!-- Trying to fix object object  -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Chat</title>
    <style>
      .message {
        padding: 5px;
        margin: 5px 0;
      }
      .system {
        background-color: #f0f0f0;
      }
      .you {
        background-color: #cce5ff;
      }
      .opponent {
        background-color: #d4edda;
      }
    </style>
  </head>
  <body>
    <div id="messages" style="height: 300px; overflow-y: scroll"></div>
    <input type="text" id="message-input" placeholder="Type a message..." />
    <button id="send-button" disabled>Send</button>

    <script>
      // WebSocket server URL
      const serverAddress = "wss://messenger-vywa.onrender.com";

      // Select elements
      const messagesDiv = document.getElementById("messages");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");

      // Create WebSocket connection
      const client = new WebSocket(serverAddress);

      // Explicitly set binary type
      client.binaryType = "blob";

      client.onopen = () => {
        addMessage("System: Connected to the server.", "system");
        sendButton.disabled = false;
      };

      client.onmessage = (event) => {
        if (event.data instanceof Blob) {
          const reader = new FileReader();
          reader.onload = () => {
            handleIncomingMessage(reader.result);
          };
          reader.readAsText(event.data);
        } else {
          handleIncomingMessage(event.data);
        }
      };

      client.onclose = () => {
        addMessage("System: Disconnected from the server.", "system");
        sendButton.disabled = true;
      };

      client.onerror = (error) => {
        addMessage(`System: WebSocket error: ${error.message}`, "system");
      };

      // Handle send button click
      sendButton.addEventListener("click", () => {
        const message = messageInput.value.trim();
        if (message) {
          client.send(message);
          addMessage(`You: ${message}`, "you");
          messageInput.value = "";
        }
      });

      // Handle pressing Enter to send a message
      messageInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          sendButton.click();
        }
      });

      // Function to handle incoming messages
      function handleIncomingMessage(data) {
        try {
          const message = JSON.parse(data); // Parse the JSON message
          if (message.type === "system") {
            addMessage(`System: ${message.content}`, "system");
          } else if (message.type === "user") {
            addMessage(`${message.sender}: ${message.content}`, "opponent");
          }
        } catch (error) {
          console.error("Error parsing incoming message:", error);
          addMessage(`Opponent: ${data}`, "opponent");
        }
      }

      // Function to add a message to the chat
      function addMessage(content, type) {
        const messageElement = document.createElement("div");
        messageElement.classList.add("message", type);
        messageElement.textContent = content;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to the latest message
      }
    </script>
  </body>
</html>
